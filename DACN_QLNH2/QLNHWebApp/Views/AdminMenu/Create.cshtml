@model QLNHWebApp.Models.MenuItem
@{
    ViewData["Title"] = "Thêm món mới";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item">
                <a asp-controller="AdminMenu" asp-action="Index">Quản lý thực đơn</a>
            </li>
            <li class="breadcrumb-item active">Thêm món mới</li>
        </ol>
    </nav>
</div>

<div class="row">
    <!-- Cột trái: Upload ảnh -->
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">Ảnh mặt hàng</h6>
            </div>
            <div class="card-body text-center">
                <div class="mb-3">
                    <img id="imagePreview"
                        src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjhmOWZhIi8+CiAgPHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OTk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkNo4buNbiDhuJ5uIGjhu5NnPC90ZXh0Pgo8L3N2Zz4K"
                        alt="Preview" class="img-fluid rounded"
                        style="max-height: 200px; width: 100%; object-fit: cover; border: 2px dashed #dee2e6;">
                </div>
                <button type="button" class="btn btn-outline-primary"
                    onclick="document.getElementById('imageFile').click()">
                    <i class="fas fa-camera me-1"></i>
                    Chọn ảnh mặt hàng
                </button>
                <input type="file" class="d-none" id="imageFile" name="imageFile" accept="image/*"
                    onchange="previewImage(this)">
                <div class="mt-3 small text-muted">
                    <div>Dung lượng file tối đa 1 MB</div>
                    <div>Định dạng: JPEG, PNG</div>
                    <div>Nên sử dụng hình ảnh có tỉ lệ 1:1</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cột phải: Form thông tin -->
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">Thông tin mặt hàng</h6>
            </div>
            <div class="card-body">
                <form asp-action="Create" method="post" enctype="multipart/form-data">
                    <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            @TempData["ErrorMessage"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    }

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="Name" class="form-label">Tên mặt hàng (*)</label>
                            <input asp-for="Name" class="form-control" placeholder="VD: Cá hồi nướng muối ớt">
                            <span asp-validation-for="Name" class="text-danger"></span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label asp-for="Category" class="form-label">Loại mặt hàng (*)</label>
                            <div class="input-group">
                                <select asp-for="Category" class="form-select">
                                    <option value="">--Chọn loại--</option>
                                    <option value="Khai vị">Khai vị</option>
                                    <option value="Món chính">Món chính</option>
                                    <option value="Tráng miệng">Tráng miệng</option>
                                    <option value="Đồ uống">Đồ uống</option>
                                    <option value="Món lẩu">Món lẩu</option>
                                    <option value="Món nướng">Món nướng</option>
                                    <option value="Món hải sản">Món hải sản</option>
                                    <option value="Món chay">Món chay</option>
                                </select>
                                <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal"
                                    data-bs-target="#addCategoryModal">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <span asp-validation-for="Category" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Đơn vị tính (*)</label>
                            <div class="input-group">
                                <select class="form-select" name="unit">
                                    <option value="">--Chọn đơn vị--</option>
                                    <option value="Phần">Phần</option>
                                    <option value="Đĩa">Đĩa</option>
                                    <option value="Ly">Ly</option>
                                    <option value="Chai">Chai</option>
                                    <option value="Lon">Lon</option>
                                </select>
                                <button type="button" class="btn btn-outline-primary">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label asp-for="Description" class="form-label">Ghi chú</label>
                            <input asp-for="Description" class="form-control" placeholder="VD: Được tùy chọn">
                        </div>
                    </div>

                    <!-- Phần giá -->
                    <div class="card mt-3">
                        <div class="card-header">
                            <h6 class="mb-0">Giá mặt hàng</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label asp-for="Price" class="form-label">Giá bán (*)</label>
                                    <div class="input-group">
                                        <input asp-for="Price" class="form-control" type="number" min="0"
                                            placeholder="0" step="1">
                                        <span class="input-group-text">đ</span>
                                    </div>
                                    <span asp-validation-for="Price" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-end mt-4">
                        <a asp-controller="AdminMenu" asp-action="Index" class="btn btn-outline-secondary me-2">
                            <i class="fas fa-arrow-left me-1"></i>
                            Quay lại
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i>
                            Lưu lại
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        function previewImage(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('imagePreview').src = e.target.result;
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Format số tiền khi nhập
        document.addEventListener('DOMContentLoaded', function () {
            const priceInput = document.querySelector('input[name="Price"]');
            if (priceInput) {
                // Xử lý khi người dùng nhập
                priceInput.addEventListener('input', function (e) {
                    let value = e.target.value.replace(/[^\d]/g, '');
                    if (value) {
                        // Lưu giá trị số để submit
                        e.target.setAttribute('data-raw-value', value);
                        // Hiển thị format cho người dùng
                        e.target.value = parseInt(value).toLocaleString('vi-VN');
                    }
                });

                // Xử lý khi submit form
                const form = document.querySelector('form');
                if (form) {
                    form.addEventListener('submit', function (e) {
                        const rawValue = priceInput.getAttribute('data-raw-value');
                        if (rawValue) {
                            priceInput.value = rawValue;
                        }
                    });
                }
            }
        });
    </script>
}